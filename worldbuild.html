<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CS77 Procedural Planet Generator</title>
  <style>
    body { margin: 0; }
		canvas { width: 100%; height: 100% }
	</style>
</head>
<body>

  <script src="three.js-master/build/three.min.js"></script>
  <script src="js/vector.js"></script>
  <script src="js/makeSphere.js"></script>
  <script src="js/editSurface.js"></script>
  <script src="js/controls.js"></script>

  <script>

  var scene, camera, renderer, controls;
  var meshList = [];
  init();
  animate();
 
 
  function init(){
    scene = new THREE.Scene();
    // (FOV, aspect, near clipping, far clipping)
    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

    renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild( renderer.domElement );
    controls = new THREE.controls(camera, renderer.domElement);

    // Add objects here

    var aLight = new THREE.AmbientLight(0x555555);
    scene.add(aLight);


    var pLight = new THREE.PointLight(0xffffff, 1, 0, 2);
    pLight.position.set(0, 50, 0);
    scene.add(pLight);
    var pLight2 = new THREE.PointLight(0xffffff, 1, 0, 2);
    pLight2.position.set(0, -50, 0);
    scene.add(pLight2);
    var pLight3 = new THREE.PointLight(0xffffff, 1, 0, 2);
    pLight3.position.set(-50, 0, 0);
    scene.add(pLight3);
    var pLight4 = new THREE.PointLight(0xffffff, 1, 0, 2);
    pLight4.position.set(50, 0, 0);
    scene.add(pLight4);
    var pLight5 = new THREE.PointLight(0xffffff, 1, 0, 2);
    pLight5.position.set(0, 0, 50);
    scene.add(pLight5);
    var pLight6 = new THREE.PointLight(0xffffff, 1, 0, 2);
    pLight6.position.set(0, 0, -50);
    scene.add(pLight6);


    // Planet Geometry
    var geometry = new THREE.Geometry();
    // getSphere(surface divisions, radius of sphere);

    // Land Construction
    console.log("Generating Land");
    var landSphere = getSphere(6,2);
    var landTexture = worleyNoise(layeredNoise(landSphere.vertices, .03, 1.3), .2, 300);
    renderMesh(landTexture, landSphere.faces, 0xA0522D);

    // Water construction
    console.log("Generating Water");
    var waterSphere = getSphere(6, 2.07);
    var waterTexture = layeredNoise(waterSphere.vertices, .02, 1.5);
    renderMesh(waterTexture, waterSphere.faces, 0x00308b);

    camera.position.z = 5;

    // Takes a set of vertices and faces and formats them so three.js can render them
    function renderMesh(vertices, faces, color){
      var geometry = new THREE.Geometry();
      for(var i = 0; i < vertices.length; i++){
        geometry.vertices.push(
          new THREE.Vector3(vertices[i].x, vertices[i].y, vertices[i].z)
        );
      }
      for (var i = 0; i < faces.length; i++){
        geometry.faces.push(
          new THREE.Face3(faces[i][0], faces[i][1], faces[i][2])
        );
      }  geometry.computeBoundingSphere();
      geometry.computeFaceNormals();
      var material = new THREE.MeshLambertMaterial({color: color});
      //var material = new THREE.MeshBasicMaterial({color: color});
      //var material = new THREE.MeshNormalMaterial();
      material.FlatShading = true;
      var mesh = new THREE.Mesh(geometry, material);
      scene.add(mesh);
      meshList.push(mesh);
    }
  }

  
  
  function animate(){
    requestAnimationFrame(animate);
    for(var i = 0; i < meshList.length; i++){
      meshList[i].rotation.x += .003;
      meshList[i].rotation.y += .003;
    }
    renderer.render(scene, camera);
  };

  </script>

</body>
</head>
